<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>何分何秒君</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    .question {
      font-size: 24px;
      margin: 20px 0;
    }
    .button-container button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 5px;
    }
    .input-container input {
      font-size: 24px;
      width: 80px;
      text-align: center;
      margin: 5px;
    }
    .fraction-display {
      display: inline-block;
      text-align: center;
    }
    .fraction-display .numerator {
      border-bottom: 1px solid #000;
    }
    .fraction-display .denominator {
    }
    .answer-section {
      margin-top: 20px;
    }
    .mixed-input {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .fraction-input {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .fraction-input input {
      width: 80px;
      font-size: 24px;
      text-align: center;
    }
    .input {
      font-size: 24px;
      width: 80px;
      text-align: center;
    }
    .result {
      margin-top: 20px;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <h1>何分何秒君</h1>
  <div class="button-container">
    <button onclick="generateQuestion('minToSec')">分 → 秒</button>
    <button onclick="generateQuestion('hourToMin')">時間 → 分</button>
    <button onclick="generateQuestion('secToMin')">秒 → 分</button>
    <button onclick="generateQuestion('minToHour')">分 → 時間</button>
  </div>
  <div class="question" id="question"></div>
  <div class="answer-section" id="answerSection"></div>
  <div class="result" id="result"></div>

  <script>
    let currentAnswer;
    let currentType;

    function gcd(a, b) {
      return b ? gcd(b, a % b) : a;
    }

    function simplifyFraction(numerator, denominator) {
      const g = gcd(numerator, denominator);
      return [numerator / g, denominator / g];
    }

    function generateQuestion(type) {
      currentType = type;
      let questionText = '';
      let answer;
      document.getElementById('result').textContent = '';

      if (type === 'minToSec') {
        const minutes = Math.floor(Math.random() * 10 + 1);
        questionText = `${minutes}分は何秒？`;
        answer = minutes * 60;
        showIntegerInput();

      } else if (type === 'hourToMin') {
        const hours = Math.floor(Math.random() * 3 + 1);
        questionText = `${hours}時間は何分？`;
        answer = hours * 60;
        showIntegerInput();

      } else if (type === 'secToMin') {
        const totalSeconds = (Math.floor(Math.random() * 4 + 1)) * 60 + [15, 20, 30, 45][Math.floor(Math.random() * 4)];
        questionText = `${totalSeconds}秒は何分？`;
        const whole = Math.floor(totalSeconds / 60);
        const remainder = totalSeconds % 60;
        const [num, den] = simplifyFraction(remainder, 60);
        answer = { whole, num, den };
        showFractionInput();

      } else if (type === 'minToHour') {
        const totalMinutes = (Math.floor(Math.random() * 2)) * 60 + [15, 20, 30, 45][Math.floor(Math.random() * 4)];
        questionText = `${totalMinutes}分は何時間？`;
        const whole = Math.floor(totalMinutes / 60);
        const remainder = totalMinutes % 60;
        const [num, den] = simplifyFraction(remainder, 60);
        answer = { whole, num, den };
        showFractionInput();
      }

      currentAnswer = answer;
      document.getElementById('question').textContent = questionText;
    }

    function showIntegerInput() {
      document.getElementById('answerSection').innerHTML = `
        <input id="intInput" type="number" class="input" autofocus>
        <button onclick="checkAnswer()">答える</button>
      `;
    }

    function showFractionInput() {
      document.getElementById('answerSection').innerHTML = `
        <div class="mixed-input">
          <input id="wholeInput" type="number" placeholder="整数" class="input">
          <div class="fraction-input">
            <input id="numInput" type="number" placeholder="分子" class="input">
            <span style="border-bottom: 1px solid #000; width: 80px;"></span>
            <input id="denInput" type="number" placeholder="分母" class="input">
          </div>
        </div>
        <button onclick="checkAnswer()">答える</button>
      `;
      setTimeout(() => document.getElementById('wholeInput').focus(), 100);

      document.getElementById('wholeInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') document.getElementById('numInput').focus();
      });
      document.getElementById('numInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') document.getElementById('denInput').focus();
      });
      document.getElementById('denInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') checkAnswer();
      });
    }

    function checkAnswer() {
      let correct = false;

      if (currentType === 'minToSec' || currentType === 'hourToMin') {
        const userAnswer = parseInt(document.getElementById('intInput').value);
        correct = userAnswer === currentAnswer;
      } else {
        const w = parseInt(document.getElementById('wholeInput').value) || 0;
        const n = parseInt(document.getElementById('numInput').value) || 0;
        const d = parseInt(document.getElementById('denInput').value) || 1;
        const [num, den] = simplifyFraction(n, d);
        correct = (w === currentAnswer.whole && num === currentAnswer.num && den === currentAnswer.den);
      }

      document.getElementById('result').textContent = correct ? '正解！' : `ちがうよ。正解は ${formatAnswer(currentAnswer)} だよ。`;
    }

    function formatAnswer(ans) {
      if (typeof ans === 'number') return `${ans}秒`;
      if (ans.num === 0) return `${ans.whole}`;
      return `${ans.whole} + ${ans.num}/${ans.den}`;
    }
  </script>
</body>
</html>
