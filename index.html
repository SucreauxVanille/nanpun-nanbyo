<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä½•åˆ†ä½•ç§’å›</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    .question {
      font-size: 24px;
      margin: 20px 0;
    }
    .button-container button {
      font-size: 20px;
      padding: 10px 20px;
      margin: 5px;
    }
    .input-container input {
      font-size: 24px;
      width: 80px;
      text-align: center;
      margin: 5px;
    }
    .fraction-display {
      display: inline-block;
      text-align: center;
    }
    .fraction-display .numerator {
      border-bottom: 1px solid #000;
    }
    .answer-section {
      margin-top: 20px;
    }
    .mixed-input {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .fraction-input {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .fraction-input input {
      width: 100px;
      font-size: 24px;
      text-align: center;
    }
    .input {
      font-size: 24px;
      width: 100px;
      text-align: center;
    }
    .result {
      margin-top: 20px;
      font-size: 26px;
      font-weight: bold;
    }
    .correct {
      color: green;
    }
    .incorrect {
      color: red;
    }
    .answer-button {
      font-size: 24px;
      padding: 12px 30px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>ä½•åˆ†ä½•ç§’å›</h1>
  <div class="button-container">
    <button onclick="generateQuestion('minToSec')">åˆ† â†’ ç§’</button>
    <button onclick="generateQuestion('hourToMin')">æ™‚é–“ â†’ åˆ†</button>
    <button onclick="generateQuestion('secToMin')">ç§’ â†’ åˆ†</button>
    <button onclick="generateQuestion('minToHour')">åˆ† â†’ æ™‚é–“</button>
  </div>
  <div class="question" id="question"></div>
  <div class="answer-section" id="answerSection"></div>
  <div class="result" id="result"></div>

  <script>
    let currentAnswer;
    let currentType;

    function gcd(a, b) {
      return b ? gcd(b, a % b) : a;
    }

    function simplifyFraction(numerator, denominator) {
      const g = gcd(numerator, denominator);
      return [numerator / g, denominator / g];
    }

    function generateQuestion(type) {
      currentType = type;
      let questionText = '';
      let answer;
      document.getElementById('result').textContent = '';
      document.getElementById('result').className = '';

      if (type === 'minToSec') {
        const minutes = Math.floor(Math.random() * 10 + 1);
        questionText = `${minutes}åˆ†ã¯ä½•ç§’ï¼Ÿ`;
        answer = minutes * 60;
        showIntegerInput();

      } else if (type === 'hourToMin') {
        const hours = Math.floor(Math.random() * 3 + 1);
        questionText = `${hours}æ™‚é–“ã¯ä½•åˆ†ï¼Ÿ`;
        answer = hours * 60;
        showIntegerInput();

      } else if (type === 'secToMin') {
        const totalSeconds = (Math.floor(Math.random() * 4 + 1)) * 60 + [15, 20, 30, 45][Math.floor(Math.random() * 4)];
        questionText = `${totalSeconds}ç§’ã¯ä½•åˆ†ï¼Ÿ`;
        const whole = Math.floor(totalSeconds / 60);
        const remainder = totalSeconds % 60;
        const [num, den] = simplifyFraction(remainder, 60);
        answer = { whole, num, den };
        showFractionInput();

      } else if (type === 'minToHour') {
        const totalMinutes = (Math.floor(Math.random() * 2)) * 60 + [15, 20, 30, 45][Math.floor(Math.random() * 4)];
        questionText = `${totalMinutes}åˆ†ã¯ä½•æ™‚é–“ï¼Ÿ`;
        const whole = Math.floor(totalMinutes / 60);
        const remainder = totalMinutes % 60;
        const [num, den] = simplifyFraction(remainder, 60);
        answer = { whole, num, den };
        showFractionInput();
      }

      currentAnswer = answer;
      document.getElementById('question').textContent = questionText;
    }

    function showIntegerInput() {
      document.getElementById('answerSection').innerHTML = `
        <input id="intInput" type="number" class="input" autofocus>
        <button onclick="checkAnswer()" class="answer-button">ç­”ãˆã‚‹ï¼</button>
      `;
    }

    function showFractionInput() {
      document.getElementById('answerSection').innerHTML = `
        <div class="mixed-input">
          <input id="wholeInput" type="number" placeholder="æ•´æ•°" class="input">
          <div class="fraction-input">
            <input id="numInput" type="number" placeholder="åˆ†å­" class="input">
            <span style="border-bottom: 1px solid #000; width: 100px;"></span>
            <input id="denInput" type="number" placeholder="åˆ†æ¯" class="input">
          </div>
        </div>
        <button onclick="checkAnswer()" class="answer-button">ç­”ãˆã‚‹ï¼</button>
      `;
      setTimeout(() => document.getElementById('wholeInput').focus(), 100);

      document.getElementById('wholeInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') document.getElementById('numInput').focus();
      });
      document.getElementById('numInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') document.getElementById('denInput').focus();
      });
      document.getElementById('denInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') checkAnswer();
      });
    }

    function checkAnswer() {
      let correct = false;

      if (currentType === 'minToSec' || currentType === 'hourToMin') {
        const userAnswer = parseInt(document.getElementById('intInput').value);
        correct = userAnswer === currentAnswer;
      } else {
        const w = parseInt(document.getElementById('wholeInput').value) || 0;
        const n = parseInt(document.getElementById('numInput').value) || 0;
        const d = parseInt(document.getElementById('denInput').value) || 1;
        const [num, den] = simplifyFraction(n, d);
        correct = (w === currentAnswer.whole && num === currentAnswer.num && den === currentAnswer.den);
      }

      const resultElement = document.getElementById('result');
      if (correct) {
        resultElement.textContent = 'ğŸ‰ æ­£è§£ï¼ ğŸ‰';
        resultElement.className = 'result correct';
      } else {
        resultElement.textContent = `ã¡ãŒã†ã‚ˆã€‚æ­£è§£ã¯ ${formatAnswer(currentAnswer)} ã ã‚ˆã€‚`;
        resultElement.className = 'result incorrect';
      }
    }

    function formatAnswer(ans) {
      if (typeof ans === 'number') return `${ans}ç§’`;
      if (ans.num === 0) return `${ans.whole}`;
      return `${ans.whole} + ${ans.num}/${ans.den}`;
    }
  </script>
</body>
</html>
